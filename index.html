{% extends "base.html" %}
{% block title %}Create a New Quiz{% endblock %}
{% block content %}
<form id="quiz-generation-form" method="POST" enctype="multipart/form-data">

    <div class="wizard-step active" id="step-1-upload">
        <div class="step-header">
            <i class="fa-solid fa-file-arrow-up fa-2x"></i>
            <h1>Upload Your Document</h1>
            <p>Choose a PDF file to generate a quiz from.</p>
        </div>
        <div class="form-group">
            <label for="pdf-file" class="file-label">
                <i class="fa-solid fa-file-pdf fa-3x"></i>
                <span id="file-label-text">Click to choose a PDF file</span>
                <span id="file-name-display"></span>
            </label>
            <input type="file" id="pdf-file" name="file" accept=".pdf" required>
        </div>
        <div id="upload-loader-container" style="display: none; text-align: center; margin-top: 20px;">
            <div class="loader"></div>
            <p>Analyzing document for topics...</p>
        </div>
        <p id="upload-error-message" class="error-text"></p>
    </div>

    <div class="wizard-step" id="step-2-topics">
        <div class="step-header">
            <i class="fa-solid fa-tags fa-2x"></i>
            <h1>Select Topics</h1>
            <p>Choose topics to focus on. Select none to use the whole document.</p>
        </div>
        <div class="form-group">
            <div id="topics-container" style="max-height: 250px; overflow-y: auto; border: 1px solid var(--border-color); padding: 15px; border-radius: 8px;">
                </div>
             <style>
                .topic-checkbox { margin-bottom: 10px; display: block; }
                .topic-checkbox input { margin-right: 8px; }
            </style>
        </div>
        <div class="button-group">
            <button type="button" id="back-to-upload-btn" class="btn-secondary">Back</button>
            <button type="button" id="go-to-configure-btn" class="btn-primary">Next</button>
        </div>
    </div>

    <div class="wizard-step" id="step-3-configure">
        <div class="step-header">
            <i class="fa-solid fa-gears fa-2x"></i>
            <h1>Configure Your Quiz</h1>
            <p>Set the number of questions and difficulty level.</p>
        </div>
        <div class="form-group">
            <label for="num-questions">Number of Questions</label>
            <input type="number" id="num-questions" name="num_questions" value="5" min="1" max="20" required>
        </div>
        <div class="form-group">
            <label>Difficulty</label>
            <div class="difficulty-options">
                <input type="radio" id="easy" name="difficulty" value="Easy">
                <label for="easy">Easy</label>
                <input type="radio" id="medium" name="difficulty" value="Medium" checked>
                <label for="medium">Medium</label>
                <input type="radio" id="hard" name="difficulty" value="Hard">
                <label for="hard">Hard</label>
            </div>
        </div>
        <div class="button-group">
            <button type="button" id="back-to-topics-btn" class="btn-secondary">Back</button>
            <button type="button" id="generate-btn" class="btn-primary">Generate Quiz</button>
        </div>
        <div id="loader-container" style="display: none; text-align: center; margin-top: 20px;">
            <div class="loader"></div>
            <p>Generating your quiz... This might take a moment.</p>
        </div>
        <p id="error-message" class="error-text"></p>
    </div>
</form>

<div class="wizard-step" id="step-4-quiz">
    <div id="quiz-header">
        <h2 id="question-counter"></h2>
        <div id="timer"><i class="fa-regular fa-clock"></i> 00:00</div>
    </div>
    <div id="quiz-content">
        <p id="question-text"></p>
        <div id="options-container"></div>
    </div>
    <div class="button-group">
        <button class="btn-secondary" id="prev-question-btn" style="display: none;">Previous</button>
        <button class="btn-primary" id="next-question-btn">Next</button>
    </div>
</div>

<div class="wizard-step" id="step-5-results">
    <div class="step-header">
        <i class="fa-solid fa-square-poll-vertical fa-2x"></i>
        <h1>Quiz Results</h1>
    </div>

    <div class="results-summary">
        <p>Total Questions: <span id="total-questions">0</span></p>
        <p>Correct Answers: <span id="correct-answers" class="correct-answer-text">0</span></p>
        <p>Incorrect Answers: <span id="incorrect-answers" class="user-answer">0</span></p>
        <p><strong>Final Score: <span id="final-score">0%</span></strong></p>
    </div>

    <div class="chart-container">
        <canvas id="results-chart"></canvas>
    </div>

    <div id="review-slider">
        <div class="review-slider-header">
            <h2>Review Your Answers</h2>
            <div class="review-nav">
                <button id="review-prev-btn" class="btn-secondary" disabled>&lt;</button>
                <span id="review-counter">1 / 1</span>
                <button id="review-next-btn" class="btn-secondary">&gt;</button>
            </div>
        </div>
        <div class="review-slider-viewport">
            <div id="review-container">
                </div>
        </div>
    </div>

    <div id="recommendations-section" style="display: none; margin-top: 40px;">
        <div class="review-slider-header">
            <h2><i class="fa-brands fa-youtube" style="color: #FF0000;"></i> Recommended Videos</h2>
        </div>
        <div id="recommendations-container" class="recommendations-grid">
            </div>
    </div>

    <div class="button-group">
        <button type="button" id="view-flashcards-btn" class="btn-secondary">View Flashcards</button>
        <button type="button" id="restart-btn" class="btn-primary">Create Another Quiz</button>
    </div>
</div>

<div class="wizard-step" id="step-6-flashcards">
    <div class="step-header">
        <i class="fa-solid fa-layer-group fa-2x"></i>
        <h1>Flashcards</h1>
        <p>Review the questions and answers.</p>
    </div>
    <div id="flashcard-container">
        <div class="flashcard">
            <div class="flashcard-inner">
                <div class="flashcard-front">
                    <div>
                        <p id="flashcard-question"></p>
                        <p id="flashcard-front-explanation" class="explanation-text"></p>
                    </div>
                </div>
                <div class="flashcard-back">
                    <p id="flashcard-back-content"></p>
                </div>
            </div>
        </div>
    </div>
    <div id="flashcard-nav">
        <button id="prev-card-btn" class="btn-secondary">&lt; Previous</button>
        <span id="flashcard-counter">1 / 1</span>
        <button id="next-card-btn" class="btn-secondary">Next &gt;</button>
    </div>
    <div class="button-group">
        <button type="button" id="download-csv-btn" class="btn-secondary">Download CSV</button>
        <button type="button" id="download-pdf-btn" class="btn-secondary">Download PDF</button>
        <button type="button" id="back-to-results-btn" class="btn-primary">Back to Results</button>
    </div>
</div>
{% endblock %}
